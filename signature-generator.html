<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业电子签名生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义主题 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#4f46e5',
                        neutral: '#1f2937',
                        light: '#f3f4f6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .signature-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .control-panel {
                @apply bg-white rounded-lg p-4 shadow-md transition-all duration-300;
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50;
            }
            .btn-secondary {
                @apply bg-white border border-gray-300 hover:bg-gray-50 text-neutral font-medium py-2 px-4 rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary/30;
            }
            .slider-control {
                @apply w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-neutral">
    <!-- 页面头部 -->
    <header class="bg-white shadow-sm py-4 px-6 md:px-12">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center space-x-2 mb-4 md:mb-0">
                <i class="fa fa-pencil-square-o text-primary text-2xl"></i>
                <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-neutral">专业电子签名生成器</h1>
            </div>
            <p class="text-gray-500 text-sm md:text-base">适用于著作权申报及各类正式文件</p>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="container mx-auto py-8 px-4 md:px-8">
        <div class="max-w-5xl mx-auto">
            <!-- 介绍卡片 -->
            <div class="bg-gradient-to-r from-primary/5 to-secondary/5 rounded-xl p-6 mb-8 border border-primary/10">
                <h2 class="text-xl font-semibold mb-2 text-neutral">创建符合规范的电子签名</h2>
                <p class="text-gray-600">使用下方工具绘制您的签名，可调整笔画粗细，选择透明背景，并以多种格式保存，满足著作权申报等正式场合需求。</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- 签名绘制区域 -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-md h-full flex flex-col">
                        <div class="mb-4 flex justify-between items-center">
                            <h3 class="font-semibold text-lg">签名绘制区</h3>
                            <span id="signature-status" class="text-sm text-gray-500">请在此绘制您的签名</span>
                        </div>
                        
                        <!-- 签名画布容器 -->
                        <div class="relative flex-grow mb-4 border-2 border-dashed border-gray-200 rounded-lg overflow-hidden bg-white" id="canvas-container" style="min-height: 300px;">
                            <canvas id="signature-canvas" class="w-full h-full cursor-crosshair"></canvas>
                            <!-- 透明背景时的网格图案 -->
                            <div id="transparent-bg-pattern" class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmNGY0ZjYiIGZpbGwtb3BhY2l0eT0iMC41Ij48cGF0aCBkPSJNIDQwIDAgMC41IDAgMCA0MCIvPjxwYXRoIGQ9Ik0gNDAgNDAgMC41IDQwIDAgMCIvPjwvZz48L2c+PC9zdmc+')] hidden"></div>
                        </div>
                        
                        <!-- 主要操作按钮 -->
                        <div class="flex flex-wrap gap-3">
                            <button id="clear-btn" class="btn-secondary flex items-center">
                                <i class="fa fa-eraser mr-2"></i> 清除签名
                            </button>
                            <button id="save-btn" class="btn-primary flex items-center ml-auto">
                                <i class="fa fa-download mr-2"></i> 保存签名
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 控制面板 -->
                <div class="space-y-6">
                    <!-- 笔画设置 -->
                    <div class="control-panel">
                        <h3 class="font-semibold text-lg mb-4 flex items-center">
                            <i class="fa fa-pencil text-primary mr-2"></i> 笔画设置
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="pen-width" class="block text-sm font-medium text-gray-700 mb-1">笔画粗细</label>
                                <input type="range" id="pen-width" class="slider-control" min="1" max="10" value="3">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>细</span>
                                    <span id="pen-width-value">3px</span>
                                    <span>粗</span>
                                </div>
                            </div>
                            
                            <div>
                                <label for="pen-color" class="block text-sm font-medium text-gray-700 mb-1">笔画颜色</label>
                                <input type="color" id="pen-color" class="w-full h-10 p-0 border-0 rounded" value="#000000">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 保存设置 -->
                    <div class="control-panel">
                        <h3 class="font-semibold text-lg mb-4 flex items-center">
                            <i class="fa fa-save text-primary mr-2"></i> 保存设置
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">背景设置</label>
                                <div class="flex items-center space-x-4">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="bg-option" value="white" class="form-radio text-primary focus:ring-primary" checked>
                                        <span class="ml-2 text-sm text-gray-700">白色背景</span>
                                    </label>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="radio" name="bg-option" value="transparent" class="form-radio text-primary focus:ring-primary">
                                        <span class="ml-2 text-sm text-gray-700">透明背景</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label for="file-format" class="block text-sm font-medium text-gray-700 mb-1">保存格式</label>
                                <select id="file-format" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/20 focus:ring-opacity-50 py-2 px-3">
                                    <option value="png">PNG 格式</option>
                                    <option value="jpeg">JPEG 格式</option>
                                    <option value="svg">SVG 格式</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 使用说明 -->
            <div class="mt-10 bg-white rounded-xl p-6 shadow-sm">
                <h3 class="font-semibold text-lg mb-3 flex items-center">
                    <i class="fa fa-info-circle text-primary mr-2"></i> 使用说明
                </h3>
                <ul class="list-disc pl-5 text-gray-600 space-y-2 text-sm md:text-base">
                    <li>在签名绘制区使用鼠标或触摸屏幕绘制您的签名</li>
                    <li>可调整笔画粗细和颜色以获得理想效果</li>
                    <li>选择透明背景适合插入到各种文档中</li>
                    <li>根据需要选择保存格式：PNG适合大多数场景，SVG适合需要无损放大的情况</li>
                    <li>生成的签名符合著作权申报等正式文件的使用要求</li>
                </ul>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-neutral text-white py-6 mt-12">
        <div class="container mx-auto px-6 text-center text-sm">
            <p>专业电子签名生成器 &copy; 2023 - 适用于著作权申报及各类正式文件</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取画布元素和上下文
            const canvas = document.getElementById('signature-canvas');
            const ctx = canvas.getContext('2d');
            const canvasContainer = document.getElementById('canvas-container');
            const transparentBgPattern = document.getElementById('transparent-bg-pattern');
            
            // 存储签名路径数据，用于精确的SVG导出
            let signaturePaths = [];
            let currentPath = [];
            
            // 设置画布尺寸
            function resizeCanvas() {
                // 保持画布的响应式尺寸
                const containerRect = canvasContainer.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1; // 处理高DPI屏幕
                
                // 保存当前画布内容
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                
                // 设置画布尺寸，考虑设备像素比以保持清晰度
                canvas.width = containerRect.width * dpr;
                canvas.height = Math.max(300, containerRect.height * 0.7) * dpr;
                
                // 调整画布的CSS尺寸
                canvas.style.width = `${containerRect.width}px`;
                canvas.style.height = `${Math.max(300, containerRect.height * 0.7)}px`;
                
                // 调整上下文比例
                ctx.scale(dpr, dpr);
                
                // 重新绘制内容
                clearCanvas();
                if (imageData && imageData.width > 0) {
                    ctx.putImageData(imageData, 0, 0);
                }
            }
            
            // 初始化时调整一次画布大小
            resizeCanvas();
            
            // 窗口大小改变时重新调整画布
            window.addEventListener('resize', resizeCanvas);
            
            // 签名状态变量
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // 画笔设置
            let penWidth = 3;
            let penColor = '#000000';
            let bgTransparent = false;
            
            // 更新画笔宽度显示
            const penWidthSlider = document.getElementById('pen-width');
            const penWidthValue = document.getElementById('pen-width-value');
            
            penWidthSlider.addEventListener('input', function() {
                penWidth = parseInt(this.value);
                penWidthValue.textContent = `${penWidth}px`;
            });
            
            // 更新画笔颜色
            const penColorPicker = document.getElementById('pen-color');
            penColorPicker.addEventListener('input', function() {
                penColor = this.value;
            });
            
            // 背景设置
            const bgOptions = document.querySelectorAll('input[name="bg-option"]');
            bgOptions.forEach(option => {
                option.addEventListener('change', function() {
                    bgTransparent = this.value === 'transparent';
                    transparentBgPattern.classList.toggle('hidden', !bgTransparent);
                    clearCanvas(); // 清除画布以应用新的背景设置
                });
            });
            
            // 开始绘制
            function startDrawing(e) {
                isDrawing = true;
                const [x, y] = getCanvasCoordinates(e);
                [lastX, lastY] = [x, y];
                
                // 开始新路径
                currentPath = [{x, y}];
                
                updateStatus('绘制中...');
            }
            
            // 绘制中
            function draw(e) {
                if (!isDrawing) return;
                
                const [x, y] = getCanvasCoordinates(e);
                
                // 记录路径点
                currentPath.push({x, y});
                
                // 绘制线条
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.strokeStyle = penColor;
                ctx.lineWidth = penWidth;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.stroke();
                
                [lastX, lastY] = [x, y];
            }
            
            // 停止绘制
            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    // 保存完整路径
                    if (currentPath.length > 1) {
                        signaturePaths.push({
                            points: [...currentPath],
                            width: penWidth,
                            color: penColor
                        });
                    }
                    currentPath = [];
                    updateStatus('签名已完成，可保存或重新绘制');
                }
            }
            
            // 获取鼠标/触摸在画布上的坐标
            function getCanvasCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1; // 考虑设备像素比
                
                // 处理触摸事件
                if (e.type.includes('touch')) {
                    e.preventDefault(); // 防止滚动
                    return [
                        (e.touches[0].clientX - rect.left) * dpr,
                        (e.touches[0].clientY - rect.top) * dpr
                    ];
                }
                
                // 处理鼠标事件
                return [
                    (e.clientX - rect.left) * dpr,
                    (e.clientY - rect.top) * dpr
                ];
            }
            
            // 清除画布
            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 如果不是透明背景，填充白色
                if (!bgTransparent) {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
                
                // 重置路径数据
                signaturePaths = [];
                currentPath = [];
                
                updateStatus('请在此绘制您的签名');
            }
            
            // 更新状态文本
            function updateStatus(text) {
                document.getElementById('signature-status').textContent = text;
            }
            
            // 保存签名
            function saveSignature() {
                // 检查是否有绘制内容
                if (signaturePaths.length === 0) {
                    alert('请先绘制签名再保存');
                    return;
                }
                
                try {
                    const format = document.getElementById('file-format').value;
                    let dataURL, mimeType, extension;
                    
                    switch(format) {
                        case 'jpeg':
                            mimeType = 'image/jpeg';
                            extension = 'jpg';
                            // 对于JPEG，需要临时创建一个带白色背景的画布
                            const tempCanvas = document.createElement('canvas');
                            tempCanvas.width = canvas.width;
                            tempCanvas.height = canvas.height;
                            const tempCtx = tempCanvas.getContext('2d');
                            
                            // 填充白色背景
                            tempCtx.fillStyle = '#ffffff';
                            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                            // 绘制原始签名
                            tempCtx.drawImage(canvas, 0, 0);
                            
                            dataURL = tempCanvas.toDataURL(mimeType, 0.95);
                            break;
                            
                        case 'svg':
                            // 生成SVG格式（修复版）
                            generateSVG();
                            return;
                            
                        case 'png':
                        default:
                            mimeType = 'image/png';
                            extension = 'png';
                            dataURL = canvas.toDataURL(mimeType);
                            break;
                    }
                    
                    // 创建下载链接
                    const link = document.createElement('a');
                    link.download = `signature.${extension}`;
                    link.href = dataURL;
                    document.body.appendChild(link); // 添加到DOM中以确保兼容性
                    link.click();
                    document.body.removeChild(link); // 清理
                    
                    updateStatus('签名已保存成功');
                } catch (error) {
                    console.error('保存签名时出错:', error);
                    alert('保存签名失败: ' + error.message);
                }
            }
            
            // 生成SVG格式（修复版）
            function generateSVG() {
                const dpr = window.devicePixelRatio || 1;
                const width = canvas.width / dpr;
                const height = canvas.height / dpr;
                
                // 创建SVG元素
                let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${width} ${height}">`;
                
                // 如果不是透明背景，添加白色背景
                if (!bgTransparent) {
                    svg += `<rect width="100%" height="100%" fill="white"/>`;
                }
                
                // 转换所有路径为SVG
                signaturePaths.forEach(path => {
                    if (path.points.length < 2) return;
                    
                    // 构建路径数据
                    let pathData = `M ${path.points[0].x/dpr} ${path.points[0].y/dpr}`;
                    for (let i = 1; i < path.points.length; i++) {
                        pathData += ` L ${path.points[i].x/dpr} ${path.points[i].y/dpr}`;
                    }
                    
                    // 添加路径到SVG
                    svg += `<path d="${pathData}" fill="none" stroke="${path.color}" 
                            stroke-width="${path.width}" stroke-linecap="round" 
                            stroke-linejoin="round"/>`;
                });
                
                svg += `</svg>`;
                
                // 创建下载链接
                try {
                    const blob = new Blob([svg], {type: 'image/svg+xml'});
                    const url = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    link.download = 'signature.svg';
                    link.href = url;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // 释放URL对象
                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                    }, 100);
                    
                    updateStatus('SVG签名已保存成功');
                } catch (error) {
                    console.error('生成SVG时出错:', error);
                    alert('生成SVG失败: ' + error.message);
                }
            }
            
            // 事件监听 - 鼠标
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // 事件监听 - 触摸
            canvas.addEventListener('touchstart', function(e) {
                startDrawing(e);
            }, { passive: false });
            
            canvas.addEventListener('touchmove', function(e) {
                draw(e);
            }, { passive: false });
            
            canvas.addEventListener('touchend', function(e) {
                stopDrawing(e);
            }, { passive: false });
            
            // 按钮事件
            document.getElementById('clear-btn').addEventListener('click', clearCanvas);
            document.getElementById('save-btn').addEventListener('click', saveSignature);
            
            // 初始化画布
            clearCanvas();
        });
    </script>
</body>
</html>
